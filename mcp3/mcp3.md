
### 方案三：【懒人 Vlog 视频生成器】(基于 moviepy)

**目标：** 图片 + 字幕 + 音乐 = 自动卡点视频。

**复制以下 Prompt 给 AI：**

> **角色设定**：你是一个 Python 视频处理专家，熟悉 `moviepy` 库。
>
> **任务**：请使用 Flask 框架编写一个 API 接口，实现“图片一键转视频”功能。
>
> **技术栈要求**：
> 1.  Web 框架：`Flask`
> 2.  视频处理：`moviepy`
>
> **接口定义**：
> - 路由：`POST /api/auto_vlog`
> - 入参形式：`multipart/form-data`
>   - `images`: 多个图片文件
>   - `audio`: 一个音频文件 (背景音乐/旁白)
>   - `captions`: 一个 JSON 字符串，格式为 `["第一张图字幕", "第二张图字幕", ...]` (可选)
>
> **核心逻辑（一步步实现）**：
> 1.  将上传的所有图片和音频保存到临时目录。
> 2.  使用 `moviepy` 处理图片：
>     - 统一将所有图片调整大小（Resize）为高度 720 像素（保持宽高比），居中裁剪或填充黑色背景以适应 1280x720 屏幕（为了避免报错，尽量简化为统一高度即可）。
>     - 设定每张图片的显示时长为 3 秒。
>     - 为每张图片之间添加简单的 `crossfadein` (淡入) 转场效果 (时长 0.5秒)。
> 3.  (可选) 添加字幕：
>     - 如果用户提供了 `captions`，使用 `TextClip` 将文字生成为白色字幕，居中放置在视频底部。
>     - **注意**：为了避免 ImageMagick 配置问题，如果 TextClip 报错，请在代码中用 try-catch 捕获并跳过字幕生成，只保留纯视频。
> 4.  处理音频：
>     - 读取上传的音频文件。
>     - 根据视频的总时长，截取音频（如果音频太长）或循环音频（如果音频太短）。
>     - 将音频合成到视频中。
> 5.  使用 `write_videofile` 导出为 `final_vlog.mp4`，使用 `libx264` 编码。
> 6.  返回生成的 MP4 文件流。
>
> **注意事项**：
> - MoviePy 处理视频比较占内存，请在生成后显式调用 `close()` 释放资源。
> - 请提供 `requirements.txt` 内容，并提示用户需要安装 ImageMagick 用于处理字幕。

---
